<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Claims Tracker ‚Äî GoldAura Therapy</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&family=DM+Serif+Display:ital@0;1&display=swap" rel="stylesheet">
    <style>
        /* ‚îÄ‚îÄ Design Tokens ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
        :root {
            --olive:       #5C6642;
            --olive-light: #8A9B6E;
            --warm-bg:     #F7F5F2;
            --card:        #FDFCFA;
            --border:      #E8E4DC;
            --text-primary:#1C1C1A;
            --text-muted:  #6B6860;
        }

        /* ‚îÄ‚îÄ Base ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background-color: var(--warm-bg);
            color: var(--text-primary);
            min-height: 100vh;
        }

        /* Grain texture overlay */
        body::before {
            content: '';
            position: fixed;
            inset: 0;
            background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 256 256' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noise)' opacity='0.04'/%3E%3C/svg%3E");
            pointer-events: none;
            z-index: 0;
            opacity: 0.4;
        }

        

        /* ‚îÄ‚îÄ Accent bar ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
        .accent-bar {
            position: fixed; top: 0; left: 0; right: 0;
            height: 3px;
            background: linear-gradient(90deg, var(--olive), var(--olive-light));
            z-index: 100;
        }

        /* ‚îÄ‚îÄ Layout ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
        .page-wrap {
            max-width: 1400px;
            margin: 0 auto;
            padding: 48px 28px 60px;
            position: relative;
            z-index: 10;
        }

        /* ‚îÄ‚îÄ Cards ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
        .app-card {
            background: var(--card);
            border: 1px solid var(--border);
            border-radius: 14px;
        }

        .stat-card {
            background: var(--card);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 24px 28px;
            flex: 1 1 0;
            min-width: 160px;
            transition: box-shadow 0.2s, transform 0.2s;
        }
        .stat-card:hover {
            box-shadow: 0 6px 20px rgba(0,0,0,0.07);
            transform: translateY(-1px);
        }

        /* ‚îÄ‚îÄ Buttons ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
        .btn-primary {
            background: var(--olive);
            color: #fff;
            border: none;
            padding: 9px 20px;
            border-radius: 999px;
            font-size: 14px;
            font-weight: 400;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            gap: 6px;
            transition: background 0.2s, box-shadow 0.2s;
            white-space: nowrap;
            font-family: 'Inter', sans-serif;
        }
        .btn-primary:hover {
            background: #4a5334;
            box-shadow: 0 4px 14px rgba(92,102,66,0.3);
        }
        .btn-primary:disabled {
            background: #a8b49a;
            cursor: not-allowed;
        }

        .btn-outline {
            background: transparent;
            color: var(--text-primary);
            border: 1px solid var(--border);
            padding: 9px 20px;
            border-radius: 999px;
            font-size: 14px;
            font-weight: 400;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            gap: 6px;
            transition: background 0.2s, border-color 0.2s;
            white-space: nowrap;
            font-family: 'Inter', sans-serif;
        }
        .btn-outline:hover {
            background: var(--warm-bg);
            border-color: #bfbbaf;
        }

        .btn-ghost {
            background: transparent;
            border: none;
            color: var(--text-muted);
            font-size: 13px;
            cursor: pointer;
            padding: 6px 10px;
            border-radius: 6px;
            transition: background 0.15s;
            font-family: 'Inter', sans-serif;
            white-space: nowrap;
        }
        .btn-ghost:hover { background: #EFECE6; }
        .btn-ghost.active { color: var(--olive); font-weight: 600; }

        /* Table action buttons */
        .btn-action {
            font-size: 12px;
            font-weight: 500;
            padding: 5px 12px;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.15s;
            border: 1px solid var(--border);
            background: white;
            color: var(--text-muted);
            font-family: 'Inter', sans-serif;
            white-space: nowrap;
        }
        .btn-action:hover { background: #EFECE6; border-color: #bfbbaf; color: var(--text-primary); }
        .btn-action.delete:hover { background: #FEF2F2; border-color: #FECACA; color: #DC2626; }
        .btn-action.submit-mark {
            background: var(--olive);
            color: white;
            border-color: var(--olive);
        }
        .btn-action.submit-mark:hover { background: #4a5334; }

        /* Auth button (setup screen) */
        .auth-button {
            background: var(--olive);
            color: white;
            padding: 14px 36px;
            border: none;
            border-radius: 999px;
            cursor: pointer;
            font-size: 15px;
            font-weight: 600;
            display: inline-flex;
            align-items: center;
            gap: 10px;
            transition: background 0.2s, box-shadow 0.2s;
            margin-top: 20px;
            font-family: 'Inter', sans-serif;
        }
        .auth-button:hover { background: #4a5334; box-shadow: 0 4px 14px rgba(92,102,66,0.3); }
        .auth-button:disabled { background: #a8b49a; cursor: not-allowed; }

        /* Modal cancel / secondary */
        .btn-modal-cancel {
            background: transparent;
            color: var(--text-muted);
            border: 1px solid var(--border);
            padding: 9px 20px;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 400;
            cursor: pointer;
            transition: all 0.15s;
            font-family: 'Inter', sans-serif;
        }
        .btn-modal-cancel:hover { background: var(--warm-bg); }

        .btn-modal-submit {
            background: var(--olive);
            color: white;
            border: none;
            padding: 9px 22px;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 400;
            cursor: pointer;
            transition: all 0.15s;
            font-family: 'Inter', sans-serif;
        }
        .btn-modal-submit:hover { background: #4a5334; }
        .btn-modal-submit:disabled { background: #a8b49a; cursor: not-allowed; }

        /* ‚îÄ‚îÄ Status badges ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
        .status-pending {
            display: inline-flex; align-items: center; gap: 4px;
            background: #FEF3C7; color: #92400E;
            font-size: 11px; font-weight: 600;
            padding: 3px 9px; border-radius: 999px;
            letter-spacing: 0.4px; text-transform: uppercase;
            white-space: nowrap;
        }
        .status-submitted {
            display: inline-flex; align-items: center; gap: 4px;
            background: #EBF0F2; color: #78898F;
            font-size: 11px; font-weight: 600;
            padding: 3px 9px; border-radius: 999px;
            letter-spacing: 0.4px; text-transform: uppercase;
            white-space: nowrap;
        }

        /* ‚îÄ‚îÄ Sync pill ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
        .sync-pill {
            display: inline-flex; align-items: center; gap: 7px;
            background: #EBF0F2; color: #78898F;
            font-size: 12px; font-weight: 400;
            padding: 6px 13px; border-radius: 999px;
            border: 1px solid #B0BFC4;
        }
        .sync-pill.syncing { background: #FFFBEB; color: #92400E; border-color: #FDE68A; }
        .sync-pill.error   { background: #FFF1F2; color: #9F1239; border-color: #FECDD3; }
        .sync-dot { width: 6px; height: 6px; border-radius: 50%; background: #78898F; flex-shrink: 0; }
        .sync-dot.syncing { background: #F59E0B; }
        .sync-dot.error   { background: #F43F5E; }

        /* ‚îÄ‚îÄ Loading spinner ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
        .loading {
            display: inline-block;
            width: 18px; height: 18px;
            border: 2.5px solid rgba(255,255,255,0.3);
            border-top-color: white;
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
        }
        .loading.dark {
            border-color: rgba(92,102,66,0.2);
            border-top-color: var(--olive);
        }
        @keyframes spin { to { transform: rotate(360deg); } }

        /* ‚îÄ‚îÄ Section label ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
        .section-label {
            font-size: 10px;
            font-weight: 500;
            letter-spacing: 0.8px;
            text-transform: uppercase;
            color: var(--text-muted);
            display: block;
            margin-bottom: 3px;
        }

        /* ‚îÄ‚îÄ Form inputs ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
        .form-label {
            font-size: 11px;
            font-weight: 400;
            letter-spacing: 0.3px;
            text-transform: uppercase;
            color: var(--text-muted);
            display: block;
            margin-bottom: 5px;
        }

        .form-input {
            font-family: 'Inter', sans-serif;
            background: var(--card);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 9px 12px;
            font-size: 14px;
            color: var(--text-primary);
            width: 100%;
            transition: border-color 0.15s, box-shadow 0.15s;
            outline: none;
        }
        .form-input:focus {
            border-color: var(--olive-light);
            box-shadow: 0 0 0 3px rgba(92,102,66,0.1);
        }
        .form-input::placeholder { color: #B0ACA3; }

        /* ‚îÄ‚îÄ Header ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
        .app-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 28px;
        }

        /* ‚îÄ‚îÄ User bar ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
        .user-bar {
            background: var(--card);
            border: 1px solid var(--border);
            border-radius: 10px;
            padding: 10px 16px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 20px;
        }

        /* ‚îÄ‚îÄ Stats row ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
        .stats-row {
            display: flex;
            gap: 14px;
            margin-bottom: 8px;
            flex-wrap: wrap;
        }

        /* ‚îÄ‚îÄ Quick-add panel ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
        .quick-add-panel {
            background: var(--card);
            border: 1px solid var(--border);
            border-radius: 12px;
            overflow: hidden;
            margin-bottom: 24px;
        }
        .quick-add-toggle {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 14px 20px;
            cursor: pointer;
            transition: background 0.15s;
        }
        .quick-add-toggle:hover { background: #F7F5F1; }

        .quick-add-body {
            overflow: hidden;
            max-height: 0;
            opacity: 0;
            transition: max-height 0.35s ease, opacity 0.25s ease;
            border-top: 0px solid var(--border);
        }
        .quick-add-body.open {
            max-height: 600px;
            opacity: 1;
            border-top-width: 1px;
        }

        .quick-add-arrow {
            font-size: 11px;
            color: var(--text-muted);
            transition: transform 0.25s ease;
        }
        .quick-add-arrow.open { transform: rotate(180deg); }

        .quick-add-form-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 14px;
            margin-bottom: 16px;
        }

        /* ‚îÄ‚îÄ Filters ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
        .filters-row {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 14px;
            margin-bottom: 20px;
        }

        /* ‚îÄ‚îÄ Table ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
        .table-toggle-btn {
            width: 100%;
            background: var(--card);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 12px 18px;
            font-size: 13px;
            font-weight: 500;
            color: var(--text-muted);
            cursor: pointer;
            text-align: left;
            margin-bottom: 12px;
            transition: background 0.15s;
            font-family: 'Inter', sans-serif;
        }
        .table-toggle-btn:hover { background: #EFECE6; }

        #tableWrapper {
            transition: max-height 0.3s ease, opacity 0.3s ease;
            overflow: hidden;
        }
        #tableWrapper.collapsed { max-height: 0; opacity: 0; }

        table { width: 100%; border-collapse: collapse; }
        thead th {
            font-size: 11px; font-weight: 400;
            color: var(--text-muted);
            text-transform: uppercase; letter-spacing: 0.4px;
            padding: 10px 14px;
            border-bottom: 1px solid var(--border);
            text-align: left;
            background: #F7F5F2;
        }
        tbody td {
            padding: 13px 14px;
            border-bottom: 1px solid #F0EDE7;
            font-size: 14px;
            color: var(--text-primary);
            vertical-align: middle;
        }
        tbody tr:hover td { background: #FAFAF7; }
        tbody tr:last-child td { border-bottom: none; }

        .empty-state {
            text-align: center;
            padding: 50px 20px;
            color: var(--text-muted);
            font-size: 14px;
        }

        /* ‚îÄ‚îÄ Modals ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
        .modal {
            display: none;
            position: fixed;
            inset: 0;
            background: rgba(28,28,26,0.45);
            backdrop-filter: blur(6px);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }
        .modal.active { display: flex; }

        .modal-box {
            background: var(--card);
            border: 1px solid var(--border);
            border-radius: 16px;
            width: 90%;
            max-width: 580px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 24px 60px rgba(0,0,0,0.18);
            animation: modalIn 0.25s ease;
        }
        .modal-box.modal-large { max-width: 860px; }

        @keyframes modalIn {
            from { opacity: 0; transform: translateY(-16px); }
            to   { opacity: 1; transform: translateY(0); }
        }

        .modal-header {
            display: flex;
            align-items: flex-start;
            justify-content: space-between;
            padding: 22px 28px;
            border-bottom: 1px solid var(--border);
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 24px;
            color: var(--text-muted);
            cursor: pointer;
            width: 32px; height: 32px;
            display: flex; align-items: center; justify-content: center;
            border-radius: 6px;
            transition: all 0.15s;
            flex-shrink: 0;
            margin-top: 2px;
        }
        .modal-close:hover { background: #EFECE6; color: var(--text-primary); }

        .modal-body { padding: 26px 28px; }

        .modal-footer {
            padding: 18px 28px;
            border-top: 1px solid var(--border);
            display: flex;
            justify-content: flex-end;
            gap: 10px;
        }

        /* Modal form 2-col grid */
        .modal-form-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 16px;
        }

        /* ‚îÄ‚îÄ Setup Screen ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
        .setup-screen {
            text-align: center;
            padding: 60px 20px 40px;
        }

        .setup-instructions {
            background: var(--card);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 32px;
            text-align: left;
            max-width: 780px;
            margin: 28px auto;
        }
        .setup-instructions h3 { color: var(--olive); margin-bottom: 14px; font-size: 17px; }
        .setup-instructions ol { margin-left: 20px; line-height: 1.9; color: var(--text-muted); font-size: 14px; }
        .setup-instructions li { margin-bottom: 8px; color: var(--text-primary); }
        .setup-instructions ul { margin-left: 18px; margin-top: 8px; }
        .setup-instructions code {
            background: #EFECE6;
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 12px;
            color: var(--olive);
        }
        .setup-instructions a { color: var(--olive-light); }

        /* ‚îÄ‚îÄ All-time stats modal ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
        .all-time-stats { display: flex; flex-direction: column; gap: 12px; }
        .stat-row-modal {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 16px 18px;
            background: var(--warm-bg);
            border-radius: 8px;
            border: 1px solid var(--border);
        }

        /* ‚îÄ‚îÄ Clients table in modal ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
        .clients-table { width: 100%; border-collapse: collapse; }
        .clients-table th {
            background: var(--warm-bg);
            padding: 10px 14px;
            text-align: left;
            font-size: 11px;
            font-weight: 600;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            border-bottom: 1px solid var(--border);
        }
        .clients-table td {
            padding: 14px;
            border-bottom: 1px solid #F0EDE7;
            font-size: 14px;
            color: var(--text-primary);
        }
        .clients-table tr:last-child td { border-bottom: none; }
        .clients-table tr:hover td { background: #FAFAF7; }


        /* ‚îÄ‚îÄ Dark mode ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
        body.dark {
            --warm-bg:     #1A1918;
            --card:        #242220;
            --border:      #343230;
            --text-primary:#F0EDE8;
            --text-muted:  #9E9A94;
        }
        body.dark .accent-bar {
            background: linear-gradient(90deg, var(--olive), #C8924F);
        }
        body.dark thead th { background: #1F1E1C; }
        body.dark tbody tr:hover td { background: #2A2826; }
        body.dark .quick-add-toggle:hover { background: #2A2826; }
        body.dark .btn-ghost:hover { background: #2E2C2A; }
        body.dark .btn-action { background: transparent; border-color: #E7CDA2; color: #E7CDA2; }
        body.dark .btn-action:hover { background: rgba(231,205,162,0.1); border-color: #E7CDA2; color: #E7CDA2; }
        body.dark .btn-action.delete { border-color: #E7CDA2; color: #E7CDA2; }
        body.dark .btn-action.delete:hover { background: rgba(231,205,162,0.1); border-color: #E7CDA2; color: #E7CDA2; }
        body.dark .btn-action.submit-mark { background: var(--olive); border-color: var(--olive); color: #fff; }
        body.dark .btn-action.submit-mark:hover { background: #4a5334; border-color: #4a5334; }
        body.dark .btn-outline { background: transparent; border-color: #3A3836; color: var(--text-primary); }
        body.dark .btn-outline:hover { background: #2A2826; }
        body.dark .modal-box { background: #242220; }
        body.dark .form-input { background: #2A2826; border-color: #3A3836; color: var(--text-primary); }
        body.dark .form-input:focus { border-color: var(--olive-light); }
        body.dark .stat-row-modal { background: #2A2826; border-color: #3A3836; }
        body.dark .table-toggle-btn { background: #242220; border-color: #343230; color: var(--text-muted); }
        body.dark .table-toggle-btn:hover { background: #2A2826; }
        body.dark .status-pending { background: #3D2D0D; color: #FBB954; }
        body.dark .status-submitted { background: #1E2A2E; color: #78898F; }
        body.dark .sync-pill { background: #1E2A2E; border-color: #3A5058; color: #78898F; }
        body.dark .clients-table th { background: #1F1E1C; }
        body.dark .clients-table tr:hover td { background: #2A2826; }

        /* Dark mode toggle button */
        .dark-toggle {
            background: transparent;
            border: 1px solid var(--border);
            border-radius: 999px;
            padding: 7px 13px;
            font-size: 13px;
            cursor: pointer;
            color: var(--text-muted);
            font-family: 'Inter', sans-serif;
            transition: all 0.15s;
            display: inline-flex;
            align-items: center;
            gap: 5px;
        }
        .dark-toggle:hover { background: var(--warm-bg); border-color: #bfbbaf; }

        /* ‚îÄ‚îÄ Hidden utility ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
        .hidden { display: none !important; }

        /* ‚îÄ‚îÄ Mobile session cards (hidden on desktop) ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
        .session-cards { display: none; }

        /* ‚îÄ‚îÄ Responsive ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
        @media (max-width: 900px) {
            .quick-add-form-grid { grid-template-columns: repeat(2, 1fr); }
            .filters-row { grid-template-columns: 1fr 1fr; }
        }

        @media (max-width: 640px) {
            /* Page */
            .page-wrap { padding: 52px 14px 48px; }

            /* Header ‚Äî stack title block above buttons */
            .app-header { flex-direction: column; gap: 12px; align-items: flex-start; }
            .app-header > div:last-child { width: 100%; justify-content: flex-start; flex-wrap: wrap; gap: 8px; }

            /* User bar ‚Äî stack vertically */
            .user-bar { flex-direction: column; align-items: flex-start; gap: 10px; }
            .user-bar > div:last-child { width: 100%; justify-content: space-between; }

            /* Stat cards ‚Äî full width stack */
            .stats-row { flex-direction: column; }
            .stat-card { min-width: unset; padding: 18px 20px; }

            /* Quick add form */
            .quick-add-form-grid { grid-template-columns: 1fr; }

            /* Filters */
            .filters-row { grid-template-columns: 1fr; }

            /* Modal form */
            .modal-form-grid { grid-template-columns: 1fr; }

            /* Modal box ‚Äî nearly full screen */
            .modal-box { width: 96%; max-height: 88vh; overflow-y: auto; }
            .modal-body { padding: 18px 18px; }
            .modal-footer { padding: 14px 18px; }
            .modal-header { padding: 16px 18px; }

            /* Table ‚Äî hide on mobile, show cards instead */
            #sessionsTable { display: none; }
            .session-cards { display: flex; flex-direction: column; gap: 10px; padding: 12px; }

            /* Table header bar ‚Äî hide sort buttons, keep title */
            .table-sort-controls { display: none; }

            /* Touch-friendly buttons */
            .btn-primary, .btn-outline { padding: 10px 16px; min-height: 44px; }
            .btn-action { min-height: 38px; padding: 8px 14px; }
            .btn-ghost { min-height: 38px; }

            /* Reduce stat number size slightly */
            #pendingCount, #monthlySubmittedCount { font-size: 40px !important; }
        }

        /* ‚îÄ‚îÄ Session card (mobile) ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
        .session-card {
            background: var(--card);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 16px;
        }
        .session-card-top {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 10px;
        }
        .session-card-name {
            font-size: 15px;
            font-weight: 600;
            color: var(--text-primary);
        }
        .session-card-meta {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 6px 16px;
            margin-bottom: 14px;
        }
        .session-card-meta-item {
            display: flex;
            flex-direction: column;
            gap: 1px;
        }
        .session-card-meta-label {
            font-size: 10px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            color: var(--text-muted);
        }
        .session-card-meta-value {
            font-size: 13px;
            color: var(--text-primary);
        }
        .session-card-actions {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }
        .session-card-actions .btn-action {
            flex: 1;
            text-align: center;
            justify-content: center;
        }
        .session-card-actions .btn-action.submit-mark {
            flex: 2;
        }

        /* Dark mode session cards */
        body.dark .session-card {
            background: var(--card);
            border-color: var(--border);
        }
    </style>
</head>
<body>
    <!-- Olive accent line at top of viewport -->
    <div class="accent-bar"></div>

    <div class="page-wrap">

        <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
             SETUP SCREEN
        ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
        <div id="setupScreen" class="setup-screen">
            <span class="section-label" style="color: #C8924F; display: block; margin-bottom: 6px;">GoldAura Therapy</span>
            <h1 style="font-size: 32px; color: var(--text-primary); font-family: 'DM Serif Display', serif;">Claims Tracker</h1>
            <p style="color: var(--text-muted); font-size: 15px; margin-top: 6px;">Connect to Google to sync your sessions across devices</p>

            <div class="setup-instructions">
                <h3>üìã One-Time Setup Instructions</h3>
                <p style="margin-bottom: 18px; font-size: 14px; color: var(--text-muted);">To sync across devices, connect this tool to your Google account:</p>
                <ol>
                    <li><strong>Get Google API Credentials</strong>
                        <ul style="margin-top: 8px;">
                            <li>Go to <a href="https://console.cloud.google.com/" target="_blank">Google Cloud Console</a></li>
                            <li>Create a new project (or use an existing one)</li>
                            <li>Enable "Google Sheets API" for your project</li>
                            <li>Go to "Credentials" and create an "OAuth 2.0 Client ID"</li>
                            <li>Add <code>http://localhost</code> and the URL where you're hosting this file to "Authorized JavaScript origins"</li>
                            <li>Copy your Client ID</li>
                        </ul>
                    </li>
                    <li style="margin-top: 12px;"><strong>Paste your Client ID below and click Connect</strong></li>
                </ol>

                <div style="margin-top: 24px;">
                    <label for="clientIdInput" class="form-label">Google OAuth Client ID</label>
                    <input type="text" id="clientIdInput" class="form-input" placeholder="Your-Client-ID.apps.googleusercontent.com">
                    <p style="font-size: 12px; color: var(--text-muted); margin-top: 8px;">Saved in your browser for future use.</p>
                </div>
            </div>

            <button class="auth-button" onclick="initializeAuth()" id="connectBtn">
                üîê Connect to Google
            </button>

            <div style="margin-top: 24px; padding: 16px 20px; background: #EEF4EE; border-radius: 10px; max-width: 780px; margin-left: auto; margin-right: auto; border: 1px solid #B8D4B8;">
                <p style="font-size: 13px; color: #3A5C3A;">
                    <strong>Note:</strong> You may see a security warning because this is a personal tool. Click "Advanced" then "Go to [your app name]" to proceed. Your data is stored only in your Google Sheets and never shared.
                </p>
            </div>
        </div>

        <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
             MAIN APP
        ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
        <div id="mainApp" class="hidden">

            <!-- Header -->
            <div class="app-header">
                <div>
                    <span class="section-label" style="color: #C8924F;">GoldAura Therapy</span>
                    <h1 style="font-size: 30px; color: var(--text-primary); margin-top: 2px; font-family: 'DM Serif Display', serif;">Claims Tracker</h1>
                    <p style="font-size: 13px; color: var(--text-muted); margin-top: 3px;">Insurance claim submissions at a glance</p>
                </div>
                <div style="display: flex; align-items: center; gap: 8px; margin-top: 4px; flex-shrink: 0;">
                    <button class="dark-toggle" onclick="toggleDarkMode()" id="darkToggleBtn" title="Toggle dark mode">‚òÄ</button>
                    <button class="btn-outline" onclick="openClientsModal()">
                        <svg width="13" height="13" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/></svg>
                        Clients
                    </button>
                    <button class="btn-primary" onclick="openNewClaimModal()">
                        <svg width="13" height="13" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/></svg>
                        New Claim
                    </button>
                </div>
            </div>

            <!-- User Bar -->
            <div class="user-bar">
                <div style="display: flex; align-items: center; gap: 12px;">
                    <div style="width: 30px; height: 30px; border-radius: 50%; background: var(--olive); display: flex; align-items: center; justify-content: center; font-size: 12px; font-weight: 700; color: white; flex-shrink: 0;">M</div>
                    <div>
                        <span style="font-size: 13px; font-weight: 500; color: var(--text-primary);" id="userEmail"></span>
                        <a href="#" id="spreadsheetLink" target="_blank" style="display: block; font-size: 12px; color: var(--olive-light); text-decoration: none; margin-top: 1px;">üìä Open in Google Sheets</a>
                    </div>
                </div>
                <div style="display: flex; align-items: center; gap: 10px;">
                    <div class="sync-pill" id="syncStatus">
                        <span class="sync-dot" id="syncDot"></span>
                        <span id="syncText">Synced</span>
                    </div>
                    <button class="btn-ghost" style="color: #DC2626; font-size: 12px; line-height: 1;" onclick="signOut()">Sign Out</button>
                </div>
            </div>

            <!-- Stat Cards -->
            <div class="stats-row">
                <div class="stat-card">
                    <span class="section-label">Last Client Submitted</span>
                    <p style="font-size: 18px; font-weight: 400; color: var(--text-primary); margin-top: 10px; line-height: 1.3;" id="latestDateDisplay">--</p>
                    <p style="font-size: 13px; color: var(--olive-light); margin-top: 3px;" id="latestClientDisplay"></p>
                </div>
                <div class="stat-card">
                    <span class="section-label">Pending</span>
                    <p style="font-size: 48px; line-height: 1; color: var(--text-primary); margin-top: 8px; font-family: 'DM Serif Display', serif;" id="pendingCount">0</p>
                </div>
                <div class="stat-card">
                    <span class="section-label" id="monthlySubmittedLabel">Submitted Since Feb 1st</span>
                    <p style="font-size: 48px; line-height: 1; color: var(--text-primary); margin-top: 8px; font-family: 'DM Serif Display', serif;" id="monthlySubmittedCount">0</p>
                </div>
            </div>
            <div style="margin: 6px 0 24px 2px;">
                <a href="#" onclick="openAllTimeStatsModal(); return false;" style="color: #B0ACA3; text-decoration: none; font-size: 12px; letter-spacing: 0.3px;">View all-time stats ‚Üí</a>
            </div>

            <!-- Quick Add Session -->
            <div class="quick-add-panel">
                <div class="quick-add-toggle" onclick="toggleQuickAdd()" id="quickAddToggle">
                    <div style="display: flex; align-items: center; gap: 10px;">
                        <div style="width: 24px; height: 24px; border-radius: 50%; background: var(--olive); display: flex; align-items: center; justify-content: center; font-size: 14px; font-weight: 400; color: white; flex-shrink: 0;">+</div>
                        <span style="font-size: 14px; font-weight: 500; color: var(--text-primary);">Quick Add Session</span>
                    </div>
                    <span class="quick-add-arrow" id="quickAddArrow">‚ñº</span>
                </div>
                <div class="quick-add-body" id="quickAddBody">
                    <div style="padding: 20px 20px 18px;">
                        <form id="inlineSessionForm" onsubmit="handleInlineFormSubmit(event)">
                            <div class="quick-add-form-grid">
                                <div>
                                    <label class="form-label">Client Name</label>
                                    <input type="text" id="inline_clientName" class="form-input" placeholder="e.g., Sarah M." required autocomplete="off">
                                </div>
                                <div>
                                    <label class="form-label">Account #</label>
                                    <input type="text" id="inline_accountNumber" class="form-input" placeholder="e.g., MG-01" required>
                                </div>
                                <div>
                                    <label class="form-label">Copay (optional)</label>
                                    <input type="text" id="inline_copay" class="form-input" placeholder="$30.00">
                                </div>
                                <div>
                                    <label class="form-label">Session Date</label>
                                    <input type="date" id="inline_sessionDate" class="form-input" required>
                                </div>
                                <div>
                                    <label class="form-label">Insurance Company</label>
                                    <select id="inline_insuranceCompany" class="form-input" required>
                                        <option value="">Select Insurance</option>
                                        <option value="Aetna">Aetna</option>
                                        <option value="Blue Cross Blue Shield">Blue Cross Blue Shield</option>
                                        <option value="Cigna">Cigna</option>
                                        <option value="State Health Plan">State Health Plan</option>
                                    </select>
                                </div>
                                <div>
                                    <label class="form-label">Insurance # (optional)</label>
                                    <input type="text" id="inline_insuranceNumber" class="form-input" placeholder="e.g., ABC123456">
                                </div>
                                <div>
                                    <label class="form-label">Diagnosis Code (optional)</label>
                                    <input type="text" id="inline_diagnosisCode" class="form-input" placeholder="e.g., F41.1">
                                </div>
                                <div>
                                    <label class="form-label">Date Submitted (optional)</label>
                                    <input type="date" id="inline_dateSubmitted" class="form-input">
                                </div>
                            </div>
                            <div style="display: flex; align-items: center; gap: 10px;">
                                <button type="submit" class="btn-modal-submit" id="inlineSubmitBtn">Add Session</button>
                                <button type="button" class="btn-modal-cancel" onclick="clearInlineForm()">Clear</button>
                                <span id="quickAddSuccess" style="display: none; align-items: center; gap: 6px; color: #7A6248; font-size: 13px; font-weight: 400;">‚úì Session added</span>
                            </div>
                        </form>
                    </div>
                </div>
            </div>

            <!-- Filters -->
            <div class="filters-row">
                <div>
                    <label class="form-label">Search Client</label>
                    <input type="text" id="searchClient" class="form-input" placeholder="Search by name...">
                </div>
                <div>
                    <label class="form-label">Insurance</label>
                    <select id="filterInsurance" class="form-input">
                        <option value="">All Companies</option>
                        <option value="Aetna">Aetna</option>
                        <option value="Blue Cross Blue Shield">Blue Cross Blue Shield</option>
                        <option value="Cigna">Cigna</option>
                        <option value="State Health Plan">State Health Plan</option>
                    </select>
                </div>
                <div>
                    <label class="form-label">Status</label>
                    <select id="filterStatus" class="form-input">
                        <option value="">All Sessions</option>
                        <option value="pending">Pending Submission</option>
                        <option value="submitted">Submitted</option>
                    </select>
                </div>
            </div>

            <!-- Sessions Table -->
            <button class="table-toggle-btn" onclick="toggleTable()" id="tableToggleBtn">‚ñº Hide Sessions Table</button>

            <div id="tableWrapper">
                <div class="app-card" style="overflow: hidden;">
                    <!-- Table header bar -->
                    <div style="display: flex; align-items: center; justify-content: space-between; padding: 12px 16px; border-bottom: 1px solid var(--border);">
                        <h2 style="font-size: 14px; font-weight: 600; color: var(--text-primary);">Sessions</h2>
                        <div style="display: flex; align-items: center; gap: 4px; flex-wrap: wrap;" class="table-sort-controls">
                            <button class="btn-ghost" onclick="toggleSort()" id="sortBtn">Newest First ‚ñº</button>
                            <button class="btn-ghost" onclick="toggleSortByStatus()" id="sortStatusBtn">Sort by Status</button>
                            <button class="btn-ghost" onclick="toggleHideCompleted()" id="hideCompletedBtn">Hide Completed</button>
                        </div>
                    </div>
                    <!-- Table -->
                    <div style="overflow-x: auto;">
                        <table id="sessionsTable">
                            <thead>
                                <tr>
                                    <th>Client</th>
                                    <th>Session Date</th>
                                    <th>Insurance</th>
                                    <th>Ins. #</th>
                                    <th>Dx Code</th>
                                    <th>Acct #</th>
                                    <th>Copay</th>
                                    <th>Submitted</th>
                                    <th>Status</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="sessionsBody">
                                <tr>
                                    <td colspan="10" class="empty-state">
                                        <div class="loading dark" style="margin: 0 auto 10px;"></div>
                                        <p>Loading your sessions...</p>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <!-- Mobile card view (shown instead of table on small screens) -->
                    <div class="session-cards" id="sessionCards">
                        <p style="text-align:center; color: var(--text-muted); font-size:14px; padding: 30px 0;">Loading your sessions...</p>
                    </div>
                </div>
            </div>

        </div><!-- end mainApp -->

    </div><!-- end page-wrap -->

    <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
         NEW CLAIM MODAL
    ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
    <div id="newClaimModal" class="modal">
        <div class="modal-box">
            <div class="modal-header">
                <div>
                    <span class="section-label" style="color: var(--olive-light);">Session Record</span>
                    <h2 style="font-size: 22px; margin-top: 2px; font-family: 'DM Serif Display', serif;" id="modalTitle">New Claim</h2>
                </div>
                <button class="modal-close" onclick="closeNewClaimModal()">&times;</button>
            </div>
            <form id="sessionForm">
                <div class="modal-body">
                    <div class="modal-form-grid">
                        <div>
                            <label class="form-label">Client Name (First, Last Initial)</label>
                            <input type="text" id="clientName" class="form-input" placeholder="e.g., Sarah M." required autocomplete="off">
                        </div>
                        <div>
                            <label class="form-label">Account Number</label>
                            <input type="text" id="accountNumber" class="form-input" placeholder="e.g., MG-01" required>
                        </div>
                        <div>
                            <label class="form-label">Copay (optional)</label>
                            <input type="text" id="copay" class="form-input" placeholder="e.g., $30.00">
                        </div>
                        <div>
                            <label class="form-label">Session Date</label>
                            <input type="date" id="sessionDate" class="form-input" required>
                        </div>
                        <div>
                            <label class="form-label">Insurance Company</label>
                            <select id="insuranceCompany" class="form-input" required>
                                <option value="">Select Insurance</option>
                                <option value="Aetna">Aetna</option>
                                <option value="Blue Cross Blue Shield">Blue Cross Blue Shield</option>
                                <option value="Cigna">Cigna</option>
                                <option value="State Health Plan">State Health Plan</option>
                            </select>
                        </div>
                        <div>
                            <label class="form-label">Insurance Number (optional)</label>
                            <input type="text" id="insuranceNumber" class="form-input" placeholder="e.g., ABC123456">
                        </div>
                        <div>
                            <label class="form-label">Diagnosis Code (optional)</label>
                            <input type="text" id="diagnosisCode" class="form-input" placeholder="e.g., F41.1">
                        </div>
                        <div>
                            <label class="form-label">Date Submitted (optional)</label>
                            <input type="date" id="dateSubmitted" class="form-input">
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn-modal-cancel" onclick="closeNewClaimModal()">Cancel</button>
                    <button type="submit" class="btn-modal-submit" id="submitBtn">Add Session</button>
                </div>
            </form>
        </div>
    </div>

    <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
         CLIENTS MODAL
    ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
    <div id="clientsModal" class="modal">
        <div class="modal-box modal-large">
            <div class="modal-header">
                <div>
                    <span class="section-label" style="color: var(--olive-light);">Overview</span>
                    <h2 style="font-size: 22px; margin-top: 2px; font-family: 'DM Serif Display', serif;">Clients</h2>
                </div>
                <button class="modal-close" onclick="closeClientsModal()">&times;</button>
            </div>
            <div class="modal-body" style="padding: 0;">
                <table class="clients-table">
                    <thead>
                        <tr>
                            <th>Client Name</th>
                            <th>Total Claims</th>
                            <th>Pending</th>
                            <th>Last Submission</th>
                        </tr>
                    </thead>
                    <tbody id="clientsTableBody">
                        <tr>
                            <td colspan="4" class="empty-state">Loading...</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
         ALL-TIME STATS MODAL
    ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
    <div id="allTimeStatsModal" class="modal">
        <div class="modal-box">
            <div class="modal-header">
                <div>
                    <span class="section-label" style="color: var(--olive-light);">Statistics</span>
                    <h2 style="font-size: 22px; margin-top: 2px; font-family: 'DM Serif Display', serif;">All-Time Stats</h2>
                </div>
                <button class="modal-close" onclick="closeAllTimeStatsModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div class="all-time-stats">
                    <div class="stat-row-modal">
                        <span style="font-size: 14px; color: var(--text-muted); font-weight: 500;">Total Sessions Ever</span>
                        <span style="font-size: 28px; font-family: 'DM Serif Display', serif;" id="allTimeTotalSessions">0</span>
                    </div>
                    <div class="stat-row-modal">
                        <span style="font-size: 14px; color: var(--text-muted); font-weight: 500;">Total Submitted Ever</span>
                        <span style="font-size: 28px; font-family: 'DM Serif Display', serif;" id="allTimeSubmittedCount">0</span>
                    </div>
                    <div class="stat-row-modal">
                        <span style="font-size: 14px; color: var(--text-muted); font-weight: 500;">Total Pending</span>
                        <span style="font-size: 28px; font-family: 'DM Serif Display', serif;" id="allTimePendingCount">0</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
         JAVASCRIPT ‚Äî all logic preserved exactly
    ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
    <script>
        let accessToken = null;
        let spreadsheetId = null;
        let sessions = [];
        let tokenClient = null;
        let gapiInited = false;
        let gisInited = false;
        let editingSessionId = null;
        let sortOrder = 'desc';       // 'desc' = newest first, 'asc' = oldest first
        let sortByStatus = false;     // false = date sort, true = status sort
        let hideCompleted = false;    // toggle to hide submitted claims
        let clientLookup = {};        // name ‚Üí { accountNumber, copay } for auto-suggest
        let quickAddOpen = false;
        let tableExpanded = true;

        const DISCOVERY_DOC = 'https://sheets.googleapis.com/$discovery/rest?version=v4';
        const SCOPES = 'https://www.googleapis.com/auth/spreadsheets https://www.googleapis.com/auth/drive.file';

        // ‚îÄ‚îÄ Google API init ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
        function gapiLoaded() { gapi.load('client', initializeGapiClient); }
        async function initializeGapiClient() {
            await gapi.client.init({ discoveryDocs: [DISCOVERY_DOC] });
            gapiInited = true;
        }
        function gisLoaded() { gisInited = true; }

        // ‚îÄ‚îÄ Auth ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
        async function initializeAuth() {
            const clientId = document.getElementById('clientIdInput').value.trim();
            if (!clientId) { alert('Please enter your Google OAuth Client ID'); return; }

            localStorage.setItem('googleClientId', clientId);
            const btn = document.getElementById('connectBtn');
            btn.disabled = true;
            btn.innerHTML = '<div class="loading"></div> Connecting...';

            tokenClient = google.accounts.oauth2.initTokenClient({
                client_id: clientId,
                scope: SCOPES,
                callback: async (response) => {
                    if (response.error !== undefined) { showError('Authentication failed: ' + response.error); return; }
                    accessToken = response.access_token;
                    await initializeApp();
                },
            });
            tokenClient.requestAccessToken({ prompt: 'consent' });
        }

        async function initializeApp() {
            try {
                const userInfo = await fetch('https://www.googleapis.com/oauth2/v2/userinfo', {
                    headers: { Authorization: `Bearer ${accessToken}` }
                });
                const userData = await userInfo.json();
                document.getElementById('userEmail').textContent = userData.email;

                // Always connect to the primary GoldAura spreadsheet
                spreadsheetId = '1hkenX5N6r83AMiLru5OY4CsptAzcLcfQPTpwKP_9JZ4';
                localStorage.setItem('claimsSpreadsheetId', spreadsheetId);
                try {
                    await gapi.client.sheets.spreadsheets.get({ spreadsheetId });
                } catch (e) {
                    await createSpreadsheet();
                }

                document.getElementById('spreadsheetLink').href = `https://docs.google.com/spreadsheets/d/${spreadsheetId}`;
                await loadSessions();

                // Show main app, hide setup
                document.getElementById('setupScreen').classList.add('hidden');
                document.getElementById('mainApp').classList.remove('hidden');

                // Wire up form and filters
                document.getElementById('sessionDate').valueAsDate = new Date();
                document.getElementById('inline_sessionDate').valueAsDate = new Date();
                document.getElementById('sessionForm').addEventListener('submit', handleFormSubmit);
                document.getElementById('searchClient').addEventListener('input', renderSessions);
                document.getElementById('filterInsurance').addEventListener('change', renderSessions);
                document.getElementById('filterStatus').addEventListener('change', renderSessions);

            } catch (error) {
                showError('Failed to initialize: ' + error.message);
            }
        }

        // ‚îÄ‚îÄ Create spreadsheet ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
        async function createSpreadsheet() {
            setSyncStatus('Creating spreadsheet...', 'syncing');
            const response = await gapi.client.sheets.spreadsheets.create({
                resource: {
                    properties: { title: 'Insurance Claims Tracker - GoldAura Therapy' },
                    sheets: [{ properties: { title: 'Claims', gridProperties: { frozenRowCount: 1 } } }]
                }
            });
            spreadsheetId = response.result.spreadsheetId;
            localStorage.setItem('claimsSpreadsheetId', spreadsheetId);

            await gapi.client.sheets.spreadsheets.values.update({
                spreadsheetId, range: 'Claims!A1:I1', valueInputOption: 'RAW',
                resource: { values: [['ID','Client Name','Account Number','Copay','Session Date','Insurance Company','Insurance Number','Diagnosis Code','Date Submitted']] }
            });
            await formatHeaders();
            setSyncStatus('Synced', 'success');
        }

        async function formatHeaders() {
            await gapi.client.sheets.spreadsheets.batchUpdate({
                spreadsheetId,
                resource: {
                    requests: [{
                        repeatCell: {
                            range: { sheetId: 0, startRowIndex: 0, endRowIndex: 1 },
                            cell: {
                                userEnteredFormat: {
                                    backgroundColor: { red: 0.2, green: 0.29, blue: 0.37 },
                                    textFormat: { foregroundColor: { red: 1, green: 1, blue: 1 }, bold: true }
                                }
                            },
                            fields: 'userEnteredFormat(backgroundColor,textFormat)'
                        }
                    }]
                }
            });
        }

        // ‚îÄ‚îÄ Load sessions from Sheets ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
        async function loadSessions() {
            setSyncStatus('Loading...', 'syncing');
            try {
                const response = await gapi.client.sheets.spreadsheets.values.get({
                    spreadsheetId, range: 'Claims!A1:I'
                });
                const rows = response.result.values || [];

                if (rows.length === 0) {
                    sessions = [];
                    renderSessions(); updateStats(); updateLatestDateSubmitted();
                    setSyncStatus('Synced', 'success');
                    return;
                }

                const headers = rows[0];
                const hasAccountNumber = headers[2] === 'Account Number';
                const hasInsuranceNumber = headers[6] === 'Insurance Number';

                if (!hasAccountNumber && rows.length > 1) {
                    await migrateToNewFormat(rows); return;
                } else if (hasAccountNumber && !hasInsuranceNumber && rows.length > 1) {
                    await migrateTo9Columns(rows); return;
                }

                sessions = rows.slice(1).map(row => ({
                    id: parseInt(row[0]),
                    clientName: row[1] || '',
                    accountNumber: row[2] || '',
                    copay: row[3] || '',
                    sessionDate: row[4] || '',
                    insuranceCompany: row[5] || '',
                    insuranceNumber: row[6] || '',
                    diagnosisCode: row[7] || '',
                    dateSubmitted: row[8] || null
                }));

                // Build client lookup for auto-suggest
                clientLookup = {};
                sessions.forEach(s => {
                    if (s.clientName && !clientLookup[s.clientName.toLowerCase()]) {
                        clientLookup[s.clientName.toLowerCase()] = { name: s.clientName, accountNumber: s.accountNumber, copay: s.copay };
                    }
                });

                renderSessions(); updateStats(); updateLatestDateSubmitted();
                setSyncStatus('Synced', 'success');
            } catch (error) {
                showError('Failed to load sessions: ' + error.message);
            }
        }

        // ‚îÄ‚îÄ Data migrations ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
        async function migrateToNewFormat(oldRows) {
            setSyncStatus('Migrating data...', 'syncing');
            try {
                const newData = [['ID','Client Name','Account Number','Copay','Session Date','Insurance Company','Date Submitted']];
                for (let i = 1; i < oldRows.length; i++) {
                    const r = oldRows[i];
                    newData.push([r[0], r[1]||'', '', '', r[2]||'', r[3]||'', r[4]||'']);
                }
                await gapi.client.sheets.spreadsheets.values.clear({ spreadsheetId, range: 'Claims!A:Z' });
                await gapi.client.sheets.spreadsheets.values.update({ spreadsheetId, range: 'Claims!A1', valueInputOption: 'RAW', resource: { values: newData } });
                await formatHeaders();
                alert('Your data has been migrated to the new format! Account Number and Copay columns have been added.');
                await loadSessions();
            } catch (error) { showError('Failed to migrate data: ' + error.message); }
        }

        async function migrateTo9Columns(oldRows) {
            setSyncStatus('Updating to new format...', 'syncing');
            try {
                const newData = [['ID','Client Name','Account Number','Copay','Session Date','Insurance Company','Insurance Number','Diagnosis Code','Date Submitted']];
                for (let i = 1; i < oldRows.length; i++) {
                    const r = oldRows[i];
                    newData.push([r[0]||'', r[1]||'', r[2]||'', r[3]||'', r[4]||'', r[5]||'', '', '', r[6]||'']);
                }
                await gapi.client.sheets.spreadsheets.values.clear({ spreadsheetId, range: 'Claims!A:Z' });
                await gapi.client.sheets.spreadsheets.values.update({ spreadsheetId, range: 'Claims!A1', valueInputOption: 'RAW', resource: { values: newData } });
                await formatHeaders();
                alert('Your data has been updated! Insurance Number and Diagnosis Code columns have been added.');
                await loadSessions();
            } catch (error) { showError('Failed to update format: ' + error.message); }
        }

        // ‚îÄ‚îÄ Form submit (add or edit) ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
        async function handleFormSubmit(e) {
            e.preventDefault();
            const submitBtn = document.getElementById('submitBtn');
            submitBtn.disabled = true;

            if (editingSessionId) {
                submitBtn.textContent = 'Updating...';
                setSyncStatus('Updating...', 'syncing');

                const rowIndex = sessions.findIndex(s => s.id === editingSessionId);
                if (rowIndex === -1) return;

                const updated = {
                    id: editingSessionId,
                    clientName: document.getElementById('clientName').value.trim(),
                    accountNumber: document.getElementById('accountNumber').value.trim(),
                    copay: formatCopay(document.getElementById('copay').value.trim()),
                    sessionDate: document.getElementById('sessionDate').value,
                    insuranceCompany: document.getElementById('insuranceCompany').value,
                    insuranceNumber: document.getElementById('insuranceNumber').value.trim() || '',
                    diagnosisCode: document.getElementById('diagnosisCode').value.trim() || '',
                    dateSubmitted: document.getElementById('dateSubmitted').value || null
                };

                try {
                    await gapi.client.sheets.spreadsheets.values.update({
                        spreadsheetId,
                        range: `Claims!A${rowIndex + 2}:I${rowIndex + 2}`,
                        valueInputOption: 'RAW',
                        resource: { values: [[updated.id, updated.clientName, updated.accountNumber, updated.copay, updated.sessionDate, updated.insuranceCompany, updated.insuranceNumber||'', updated.diagnosisCode||'', updated.dateSubmitted||'']] }
                    });
                    sessions[rowIndex] = updated;
                    clientLookup[updated.clientName.toLowerCase()] = { name: updated.clientName, accountNumber: updated.accountNumber, copay: updated.copay };
                    editingSessionId = null;
                    clearForm(); closeNewClaimModal();
                    renderSessions(); updateStats(); updateLatestDateSubmitted();
                    setSyncStatus('Synced', 'success');
                } catch (error) { showError('Failed to update session: ' + error.message); }
                finally { submitBtn.disabled = false; submitBtn.textContent = 'Update Session'; document.getElementById('modalTitle').textContent = 'New Claim'; }

            } else {
                submitBtn.textContent = 'Adding...';
                setSyncStatus('Saving...', 'syncing');

                const session = {
                    id: Date.now(),
                    clientName: document.getElementById('clientName').value.trim(),
                    accountNumber: document.getElementById('accountNumber').value.trim(),
                    copay: formatCopay(document.getElementById('copay').value.trim()),
                    sessionDate: document.getElementById('sessionDate').value,
                    insuranceCompany: document.getElementById('insuranceCompany').value,
                    insuranceNumber: document.getElementById('insuranceNumber').value.trim() || '',
                    diagnosisCode: document.getElementById('diagnosisCode').value.trim() || '',
                    dateSubmitted: document.getElementById('dateSubmitted').value || null
                };

                try {
                    await gapi.client.sheets.spreadsheets.values.append({
                        spreadsheetId, range: 'Claims!A:I', valueInputOption: 'RAW',
                        resource: { values: [[session.id, session.clientName, session.accountNumber, session.copay, session.sessionDate, session.insuranceCompany, session.insuranceNumber||'', session.diagnosisCode||'', session.dateSubmitted||'']] }
                    });
                    sessions.push(session);
                    clientLookup[session.clientName.toLowerCase()] = { name: session.clientName, accountNumber: session.accountNumber, copay: session.copay };
                    clearForm(); closeNewClaimModal();
                    renderSessions(); updateStats(); updateLatestDateSubmitted();
                    setSyncStatus('Synced', 'success');
                } catch (error) { showError('Failed to save session: ' + error.message); }
                finally { submitBtn.disabled = false; submitBtn.textContent = 'Add Session'; }
            }
        }

        // ‚îÄ‚îÄ Delete session ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
        async function deleteSession(id) {
            if (!confirm('Are you sure you want to delete this session?')) return;
            setSyncStatus('Deleting...', 'syncing');
            try {
                sessions = sessions.filter(s => s.id !== id);
                const allData = [['ID','Client Name','Account Number','Copay','Session Date','Insurance Company','Insurance Number','Diagnosis Code','Date Submitted']];
                sessions.forEach(s => allData.push([s.id, s.clientName, s.accountNumber, s.copay, s.sessionDate, s.insuranceCompany, s.insuranceNumber||'', s.diagnosisCode||'', s.dateSubmitted||'']));
                await gapi.client.sheets.spreadsheets.values.clear({ spreadsheetId, range: 'Claims!A:Z' });
                await gapi.client.sheets.spreadsheets.values.update({ spreadsheetId, range: 'Claims!A1', valueInputOption: 'RAW', resource: { values: allData } });
                await formatHeaders();
                renderSessions(); updateStats(); updateLatestDateSubmitted();
                setSyncStatus('Synced', 'success');
            } catch (error) {
                showError('Failed to delete session: ' + (error.message || 'Unknown error.'));
                await loadSessions();
            }
        }

        // ‚îÄ‚îÄ Mark submitted ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
        async function markSubmitted(id) {
            setSyncStatus('Updating...', 'syncing');
            try {
                const rowIndex = sessions.findIndex(s => s.id === id);
                if (rowIndex === -1) return;
                const today = new Date();
                const todayFormatted = `${today.getFullYear()}-${String(today.getMonth()+1).padStart(2,'0')}-${String(today.getDate()).padStart(2,'0')}`;

                // Column I (index 9) is Date Submitted ‚Äî row = rowIndex + 2
                await gapi.client.sheets.spreadsheets.values.update({
                    spreadsheetId,
                    range: `Claims!I${rowIndex + 2}`,
                    valueInputOption: 'RAW',
                    resource: { values: [[todayFormatted]] }
                });
                sessions[rowIndex].dateSubmitted = todayFormatted;
                renderSessions(); updateStats(); updateLatestDateSubmitted();
                setSyncStatus('Synced', 'success');
            } catch (error) { showError('Failed to update session: ' + error.message); }
        }

        // ‚îÄ‚îÄ Edit session ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
        function editSession(id) {
            const s = sessions.find(x => x.id === id);
            if (!s) return;
            editingSessionId = id;
            document.getElementById('clientName').value = s.clientName;
            document.getElementById('accountNumber').value = s.accountNumber;
            document.getElementById('copay').value = s.copay;
            document.getElementById('sessionDate').value = s.sessionDate;
            document.getElementById('insuranceCompany').value = s.insuranceCompany;
            document.getElementById('insuranceNumber').value = s.insuranceNumber || '';
            document.getElementById('diagnosisCode').value = s.diagnosisCode || '';
            document.getElementById('dateSubmitted').value = s.dateSubmitted || '';
            document.getElementById('submitBtn').textContent = 'Update Session';
            document.getElementById('modalTitle').textContent = 'Edit Session';
            openNewClaimModal();
        }

        // ‚îÄ‚îÄ Clear form ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
        function clearForm() {
            document.getElementById('sessionForm').reset();
            document.getElementById('sessionDate').valueAsDate = new Date();
            editingSessionId = null;
            document.getElementById('submitBtn').textContent = 'Add Session';
            document.getElementById('modalTitle').textContent = 'New Claim';
        }

        // ‚îÄ‚îÄ Inline quick-add ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
        function toggleQuickAdd() {
            quickAddOpen = !quickAddOpen;
            const body = document.getElementById('quickAddBody');
            const arrow = document.getElementById('quickAddArrow');
            if (quickAddOpen) {
                body.classList.add('open');
                arrow.classList.add('open');
                document.getElementById('inline_sessionDate').valueAsDate = new Date();
            } else {
                body.classList.remove('open');
                arrow.classList.remove('open');
            }
        }

        function clearInlineForm() {
            document.getElementById('inlineSessionForm').reset();
            document.getElementById('inline_sessionDate').valueAsDate = new Date();
            document.getElementById('quickAddSuccess').style.display = 'none';
        }

        async function handleInlineFormSubmit(e) {
            e.preventDefault();
            const btn = document.getElementById('inlineSubmitBtn');
            btn.disabled = true; btn.textContent = 'Adding...';

            const session = {
                id: Date.now(),
                clientName: document.getElementById('inline_clientName').value.trim(),
                accountNumber: document.getElementById('inline_accountNumber').value.trim(),
                copay: formatCopay(document.getElementById('inline_copay').value.trim()),
                sessionDate: document.getElementById('inline_sessionDate').value,
                insuranceCompany: document.getElementById('inline_insuranceCompany').value,
                insuranceNumber: document.getElementById('inline_insuranceNumber').value.trim() || '',
                diagnosisCode: document.getElementById('inline_diagnosisCode').value.trim() || '',
                dateSubmitted: document.getElementById('inline_dateSubmitted').value || null
            };

            try {
                await gapi.client.sheets.spreadsheets.values.append({
                    spreadsheetId, range: 'Claims!A:I', valueInputOption: 'RAW',
                    resource: { values: [[session.id, session.clientName, session.accountNumber, session.copay, session.sessionDate, session.insuranceCompany, session.insuranceNumber, session.diagnosisCode, session.dateSubmitted||'']] }
                });
                sessions.push(session);
                clientLookup[session.clientName.toLowerCase()] = { name: session.clientName, accountNumber: session.accountNumber, copay: session.copay };

                // Clear name/account/copay/insurance/optional fields, keep date
                document.getElementById('inline_clientName').value = '';
                document.getElementById('inline_accountNumber').value = '';
                document.getElementById('inline_copay').value = '';
                document.getElementById('inline_sessionDate').valueAsDate = new Date();
                document.getElementById('inline_insuranceCompany').value = '';
                document.getElementById('inline_insuranceNumber').value = '';
                document.getElementById('inline_diagnosisCode').value = '';
                document.getElementById('inline_dateSubmitted').value = '';

                const successEl = document.getElementById('quickAddSuccess');
                successEl.style.display = 'flex';
                setTimeout(() => { successEl.style.display = 'none'; }, 2500);
                document.getElementById('inline_clientName').focus();

                renderSessions(); updateStats(); updateLatestDateSubmitted();
                setSyncStatus('Synced', 'success');
            } catch (error) { showError('Failed to save session: ' + error.message); }
            finally { btn.disabled = false; btn.textContent = 'Add Session'; }
        }

        // ‚îÄ‚îÄ Render sessions table ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
        function renderSessions() {
            const tbody = document.getElementById('sessionsBody');
            const searchTerm = document.getElementById('searchClient').value.toLowerCase();
            const filterInsurance = document.getElementById('filterInsurance').value;
            const filterStatus = document.getElementById('filterStatus').value;

            let filtered = sessions.filter(s => {
                const matchesSearch = s.clientName.toLowerCase().includes(searchTerm);
                const matchesInsurance = !filterInsurance || s.insuranceCompany === filterInsurance;
                const matchesStatus = !filterStatus ||
                    (filterStatus === 'pending' && !s.dateSubmitted) ||
                    (filterStatus === 'submitted' && s.dateSubmitted);
                const matchesHide = !hideCompleted || !s.dateSubmitted;
                return matchesSearch && matchesInsurance && matchesStatus && matchesHide;
            });

            if (sortByStatus) {
                filtered.sort((a, b) => {
                    const diff = (a.dateSubmitted ? 1 : 0) - (b.dateSubmitted ? 1 : 0);
                    if (diff !== 0) return diff;
                    return new Date(b.sessionDate) - new Date(a.sessionDate);
                });
            } else {
                filtered.sort((a, b) => sortOrder === 'desc'
                    ? new Date(b.sessionDate) - new Date(a.sessionDate)
                    : new Date(a.sessionDate) - new Date(b.sessionDate));
            }

            if (filtered.length === 0) {
                tbody.innerHTML = '<tr><td colspan="10" class="empty-state">No sessions match your filters.</td></tr>';
                document.getElementById('sessionCards').innerHTML = '<p style="text-align:center; color: var(--text-muted); font-size:14px; padding: 30px 0;">No sessions match your filters.</p>';
                return;
            }

            tbody.innerHTML = filtered.map(s => {
                const submitted = s.dateSubmitted ? formatDate(s.dateSubmitted) : '‚Äî';
                const statusBadge = s.dateSubmitted
                    ? '<span class="status-submitted">Submitted</span>'
                    : '<span class="status-pending">Pending</span>';
                const markBtn = !s.dateSubmitted
                    ? `<button class="btn-action submit-mark" style="width:100%; margin-top:4px;" onclick="markSubmitted(${s.id})">Mark Submitted</button>`
                    : '';

                return `
                    <tr>
                        <td style="font-weight: 500;">${s.clientName}</td>
                        <td style="color: var(--text-muted);">${formatDate(s.sessionDate)}</td>
                        <td>${s.insuranceCompany}</td>
                        <td style="color: var(--text-muted);">${s.insuranceNumber || ''}</td>
                        <td style="color: var(--text-muted);">${s.diagnosisCode || ''}</td>
                        <td style="color: var(--text-muted);">${s.accountNumber}</td>
                        <td>${s.copay}</td>
                        <td style="color: var(--text-muted);">${submitted}</td>
                        <td>${statusBadge}</td>
                        <td>
                            <div style="display:flex; flex-direction:column; gap:0;">
                                <div style="display:flex; gap:5px;">
                                    <button class="btn-action" onclick="editSession(${s.id})">Edit</button>
                                    <button class="btn-action delete" onclick="deleteSession(${s.id})">Delete</button>
                                </div>
                                ${markBtn}
                            </div>
                        </td>
                    </tr>`;
            }).join('');

            // ‚îÄ‚îÄ Mobile card view ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
            document.getElementById('sessionCards').innerHTML = filtered.map(s => {
                const submitted = s.dateSubmitted ? formatDate(s.dateSubmitted) : '‚Äî';
                const statusBadge = s.dateSubmitted
                    ? '<span class="status-submitted">Submitted</span>'
                    : '<span class="status-pending">Pending</span>';
                const markBtn = !s.dateSubmitted
                    ? `<button class="btn-action submit-mark" onclick="markSubmitted(${s.id})" style="flex:2;">Mark Submitted</button>`
                    : '';

                return `
                    <div class="session-card">
                        <div class="session-card-top">
                            <span class="session-card-name">${s.clientName}</span>
                            ${statusBadge}
                        </div>
                        <div class="session-card-meta">
                            <div class="session-card-meta-item">
                                <span class="session-card-meta-label">Session Date</span>
                                <span class="session-card-meta-value">${formatDate(s.sessionDate)}</span>
                            </div>
                            <div class="session-card-meta-item">
                                <span class="session-card-meta-label">Insurance</span>
                                <span class="session-card-meta-value">${s.insuranceCompany}</span>
                            </div>
                            <div class="session-card-meta-item">
                                <span class="session-card-meta-label">Acct #</span>
                                <span class="session-card-meta-value">${s.accountNumber}</span>
                            </div>
                            <div class="session-card-meta-item">
                                <span class="session-card-meta-label">Copay</span>
                                <span class="session-card-meta-value">${s.copay}</span>
                            </div>
                            ${s.diagnosisCode ? `
                            <div class="session-card-meta-item">
                                <span class="session-card-meta-label">Dx Code</span>
                                <span class="session-card-meta-value">${s.diagnosisCode}</span>
                            </div>` : ''}
                            ${s.dateSubmitted ? `
                            <div class="session-card-meta-item">
                                <span class="session-card-meta-label">Submitted</span>
                                <span class="session-card-meta-value">${submitted}</span>
                            </div>` : ''}
                        </div>
                        <div class="session-card-actions">
                            <button class="btn-action" onclick="editSession(${s.id})" style="flex:1;">Edit</button>
                            <button class="btn-action delete" onclick="deleteSession(${s.id})" style="flex:1;">Delete</button>
                            ${markBtn}
                        </div>
                    </div>`;
            }).join('');
        }

        // ‚îÄ‚îÄ Stats ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
        function updateStats() {
            document.getElementById('pendingCount').textContent = sessions.filter(s => !s.dateSubmitted).length;
            updateMonthlySubmitted();
        }

        function updateMonthlySubmitted() {
            const today = new Date();
            const m = today.getMonth(), y = today.getFullYear();
            const monthNames = ['January','February','March','April','May','June','July','August','September','October','November','December'];
            document.getElementById('monthlySubmittedLabel').textContent = `Submitted Since ${monthNames[m].slice(0,3)} 1st`;
            const count = sessions.filter(s => {
                if (!s.dateSubmitted) return false;
                const d = new Date(s.sessionDate + 'T00:00:00');
                return d.getMonth() === m && d.getFullYear() === y;
            }).length;
            document.getElementById('monthlySubmittedCount').textContent = count;
        }

        function updateLatestDateSubmitted() {
            const submitted = sessions.filter(s => s.dateSubmitted);
            if (submitted.length === 0) {
                document.getElementById('latestDateDisplay').textContent = '--';
                document.getElementById('latestClientDisplay').textContent = '';
                return;
            }
            submitted.sort((a, b) => new Date(b.sessionDate) - new Date(a.sessionDate));
            const latest = submitted[0];
            const date = new Date(latest.sessionDate + 'T00:00:00');
            document.getElementById('latestDateDisplay').textContent = date.toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' });
            document.getElementById('latestClientDisplay').textContent = latest.clientName;
        }

        // ‚îÄ‚îÄ All-time stats modal ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
        function updateAllTimeStats() {
            const total = sessions.length;
            const submitted = sessions.filter(s => s.dateSubmitted).length;
            document.getElementById('allTimeTotalSessions').textContent = total;
            document.getElementById('allTimeSubmittedCount').textContent = submitted;
            document.getElementById('allTimePendingCount').textContent = total - submitted;
        }

        // ‚îÄ‚îÄ Clients list ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
        function renderClientsList() {
            const tbody = document.getElementById('clientsTableBody');
            const map = {};
            sessions.forEach(s => {
                if (!map[s.clientName]) map[s.clientName] = { name: s.clientName, totalClaims: 0, pendingClaims: 0, lastSubmission: null };
                map[s.clientName].totalClaims++;
                if (!s.dateSubmitted) map[s.clientName].pendingClaims++;
                if (s.dateSubmitted && (!map[s.clientName].lastSubmission || new Date(s.sessionDate) > new Date(map[s.clientName].lastSubmission))) {
                    map[s.clientName].lastSubmission = s.sessionDate;
                }
            });
            const arr = Object.values(map).sort((a, b) => a.name.localeCompare(b.name));
            if (arr.length === 0) {
                tbody.innerHTML = '<tr><td colspan="4" class="empty-state">No clients yet</td></tr>';
                return;
            }
            tbody.innerHTML = arr.map(c => `
                <tr>
                    <td style="font-weight: 500;">${c.name}</td>
                    <td>${c.totalClaims}</td>
                    <td>${c.pendingClaims}</td>
                    <td>${c.lastSubmission ? formatDate(c.lastSubmission) : '-'}</td>
                </tr>`).join('');
        }

        // ‚îÄ‚îÄ Sort & filter toggles ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
        function toggleSort() {
            sortOrder = sortOrder === 'desc' ? 'asc' : 'desc';
            document.getElementById('sortBtn').textContent = sortOrder === 'desc' ? 'Newest First ‚ñº' : 'Oldest First ‚ñ≤';
            sortByStatus = false;
            document.getElementById('sortStatusBtn').classList.remove('active');
            renderSessions();
        }

        function toggleSortByStatus() {
            sortByStatus = !sortByStatus;
            const btn = document.getElementById('sortStatusBtn');
            btn.textContent = sortByStatus ? 'Sort by Status ‚úì' : 'Sort by Status';
            btn.classList.toggle('active', sortByStatus);
            renderSessions();
        }

        function toggleHideCompleted() {
            hideCompleted = !hideCompleted;
            const btn = document.getElementById('hideCompletedBtn');
            btn.textContent = hideCompleted ? 'Show Completed' : 'Hide Completed';
            btn.classList.toggle('active', hideCompleted);
            renderSessions();
        }

        function toggleTable() {
            tableExpanded = !tableExpanded;
            document.getElementById('tableWrapper').classList.toggle('collapsed', !tableExpanded);
            document.getElementById('tableToggleBtn').textContent = tableExpanded ? '‚ñº Hide Sessions Table' : '‚ñ∂ Show Sessions Table';
        }

        // ‚îÄ‚îÄ Sync status pill ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
        function setSyncStatus(message, type) {
            const pill = document.getElementById('syncStatus');
            const dot  = document.getElementById('syncDot');
            const text = document.getElementById('syncText');
            pill.className = 'sync-pill';
            dot.className = 'sync-dot';
            if (type === 'syncing') {
                pill.classList.add('syncing');
                dot.classList.add('syncing');
                text.textContent = message;
            } else if (type === 'error') {
                pill.classList.add('error');
                dot.classList.add('error');
                text.textContent = message;
            } else {
                text.textContent = 'Synced';
            }
        }

        function showError(msg) { setSyncStatus('Error', 'error'); alert(msg); }

        // ‚îÄ‚îÄ Copay formatter ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
        function formatCopay(value) {
            if (!value || value.trim() === '') return '$0.00';
            value = value.replace(/[\$\s]/g, '');
            if (value && !isNaN(value)) return '$' + parseFloat(value).toFixed(2);
            return '$0.00';
        }

        // ‚îÄ‚îÄ Date formatter ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
        function formatDate(dateString) {
            const d = new Date(dateString + 'T00:00:00');
            return d.toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' });
        }


        // ‚îÄ‚îÄ Dark mode toggle ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
        function toggleDarkMode() {
            const isDark = document.body.classList.toggle('dark');
            localStorage.setItem('darkMode', isDark ? '1' : '0');
            document.getElementById('darkToggleBtn').textContent = isDark ? '‚òΩ' : '‚òÄ';
        }

        // ‚îÄ‚îÄ Sign out ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
        function signOut() {
            if (confirm('Are you sure you want to sign out?')) { accessToken = null; location.reload(); }
        }

        // ‚îÄ‚îÄ Modal open/close ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
        function openNewClaimModal() {
            document.getElementById('newClaimModal').classList.add('active');
            if (!editingSessionId) document.getElementById('sessionDate').valueAsDate = new Date();
        }
        function closeNewClaimModal() {
            document.getElementById('newClaimModal').classList.remove('active');
            if (!editingSessionId) clearForm();
        }
        function openClientsModal() {
            document.getElementById('clientsModal').classList.add('active');
            renderClientsList();
        }
        function closeClientsModal() { document.getElementById('clientsModal').classList.remove('active'); }
        function openAllTimeStatsModal() {
            document.getElementById('allTimeStatsModal').classList.add('active');
            updateAllTimeStats();
        }
        function closeAllTimeStatsModal() { document.getElementById('allTimeStatsModal').classList.remove('active'); }

        // Close modal on backdrop click
        window.addEventListener('click', function(e) {
            if (e.target.classList.contains('modal')) {
                e.target.classList.remove('active');
                if (e.target.id === 'newClaimModal' && !editingSessionId) clearForm();
            }
        });

        // Close modal on Escape
        window.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') { closeNewClaimModal(); closeClientsModal(); closeAllTimeStatsModal(); }
        });

        // ‚îÄ‚îÄ Auto-suggest + copay format on blur ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
        document.addEventListener('DOMContentLoaded', function() {
            // Modal form
            document.getElementById('clientName').addEventListener('input', function(e) {
                const v = e.target.value.toLowerCase().trim();
                if (v.length > 0 && clientLookup[v]) {
                    document.getElementById('accountNumber').value = clientLookup[v].accountNumber;
                    document.getElementById('copay').value = clientLookup[v].copay;
                }
            });
            document.getElementById('copay').addEventListener('blur', function(e) { e.target.value = formatCopay(e.target.value); });

            // Inline form
            document.getElementById('inline_clientName').addEventListener('input', function(e) {
                const v = e.target.value.toLowerCase().trim();
                if (v.length > 0 && clientLookup[v]) {
                    document.getElementById('inline_accountNumber').value = clientLookup[v].accountNumber;
                    document.getElementById('inline_copay').value = clientLookup[v].copay;
                }
            });
            document.getElementById('inline_copay').addEventListener('blur', function(e) { e.target.value = formatCopay(e.target.value); });
        });

        // ‚îÄ‚îÄ Restore saved client ID and dark mode on page load ‚îÄ‚îÄ
        window.onload = function() {
            const saved = localStorage.getItem('googleClientId');
            if (saved) document.getElementById('clientIdInput').value = saved;
            if (localStorage.getItem('darkMode') === '1') {
                document.body.classList.add('dark');
                const btn = document.getElementById('darkToggleBtn');
                if (btn) btn.textContent = '‚òΩ';
            }
        };

        // Expose API loader callbacks to global scope
        window.gapiLoaded = gapiLoaded;
        window.gisLoaded = gisLoaded;
    </script>

    <script async defer src="https://apis.google.com/js/api.js" onload="gapiLoaded()"></script>
    <script async defer src="https://accounts.google.com/gsi/client" onload="gisLoaded()"></script>
</body>
</html>
